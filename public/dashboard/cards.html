<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <link
      rel="shortcut icon"
      href="../assets/imgs/icon/icon.jpg"
      type="image/x-icon"
    />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Beatles | Cards</title>
    <link rel="stylesheet" href="style_dash.css" />
    <script src="../js/funcoes.js"></script>
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
  </head>

  <body onload="validarSessao(), atualizacaoPeriodica()">
    <!-- atualizacaoPeriodica() -->
    <div class="janela">
      <div class="header-left dash-header">
        <span>
          <img
            class="img_navbar"
            src="../assets/imgs/abbey_road.gif"
            alt="gif"
          />
        </span>

        <div class="hello">
          <div>
            <h2>Olá, <span id="b_usuario">usuário</span>!</h2>
          </div>
          <div>
            <h2>
              Album favorito é... <br />
              <span id="b_usuario_album">album</span>
            </h2>
          </div>
        </div>

        <div class="btn-nav">
          <a href="dashboard.html">
            <h3>Gráficos</h3>
          </a>
        </div>

        <div class="btn-logout" onclick="limparSessao()">
          <h3>Sair</h3>
        </div>
      </div>

      <div class="dash_card">
        <div class="regua">
          <div class="item-regua perigo-frio">
            <h2>Menos votos</h2>
            <div>
              <h2>5</h2>
            </div>
          </div>

          <div class="item-regua ideal">
            <h2>Media de votos</h2>
            <div>
              <h2>6 | 8</h2>
            </div>
          </div>

          <div class="item-regua perigo-quente">
            <h2>Mais votos</h2>
            <div>
              <h2>9</h2>
            </div>
          </div>
        </div>

        <div class="cards">
          <div class="card">
            <h1>Please Please Me</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/please_please_me.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_1"></div>
            <p id="numero_votos_1"></p>
          </div>
          <div class="card">
            <h1>With The Beatles</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/with_the_beatles.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_2"></div>
            <p id="numero_votos_2"></p>
          </div>
          <div class="card">
            <h1>A Hard Day's Night</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/a_hard_days_night.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_3"></div>
            <p id="numero_votos_3"></p>
          </div>
          <div class="card">
            <h1>Beatles For Sale</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/beatles_for_sale.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_4"></div>
            <p id="numero_votos_4"></p>
          </div>
          <div class="card">
            <h1>Help!</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/help.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_5"></div>
            <p id="numero_votos_5"></p>
          </div>
          <div class="card">
            <h1>Rubber Soul</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/rubber_soul.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_6"></div>
            <p id="numero_votos_6"></p>
          </div>
          <div class="card">
            <h1>Revolver</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/revolver.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_7"></div>
            <p id="numero_votos_7"></p>
          </div>
          <div class="card">
            <h1>Sgt.Pepper's Lonely Hearts Club Band</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/sgt_peppers.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_8"></div>
            <p id="numero_votos_8"></p>
          </div>
          <div class="card">
            <h1>Magical Mystery Tour</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/magical_mystery_tour.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_9"></div>
            <p id="numero_votos_9"></p>
          </div>
          <div class="card">
            <h1>The Beatles - White album</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/white_album.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_10"></div>
            <p id="numero_votos_10"></p>
          </div>
          <div class="card">
            <h1>Yellow Submarine</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/yellow_submarine.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_11"></div>
            <p id="numero_votos_11"></p>
          </div>
          <div class="card">
            <h1>Abbey Road</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/abbey_road.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_12"></div>
            <p id="numero_votos_12"></p>
          </div>
          <div class="card">
            <h1>Let It Be</h1>
            <div class="capa_album">
              <img
                class="tamanho_album"
                src="../assets/imgs/albums/let_it_be.jpg"
                alt=""
              />
            </div>
            <div class="cor-alerta" id="card_13"></div>
            <p id="numero_votos_13"></p>
          </div>
        </div>

        <div class="bubbles">
          <span style="--i: 11"></span>
          <span style="--i: 12"></span>
          <span style="--i: 24"></span>
          <span style="--i: 10"></span>
          <span style="--i: 14"></span>
          <span style="--i: 23"></span>
          <span style="--i: 18"></span>
          <span style="--i: 16"></span>
          <span style="--i: 19"></span>
          <span style="--i: 20"></span>
          <span style="--i: 22"></span>
          <span style="--i: 25"></span>
          <span style="--i: 18"></span>
          <span style="--i: 21"></span>
          <span style="--i: 15"></span>
          <span style="--i: 13"></span>
          <span style="--i: 26"></span>
          <span style="--i: 17"></span>
          <span style="--i: 13"></span>
          <span style="--i: 28"></span>
          <span style="--i: 29"></span>
          <span style="--i: 30"></span>
        </div>
      </div>
    </div>
  </body>

  <script>
    function atualizacaoPeriodica() {
      obterdados(1);
      // obterdados(2);
      // obterdados(3);
      // obterdados(4);

      function sendData() {
        var http = new XMLHttpRequest();
        http.open("POST", "http://localhost:3000/api/sendData", false);
        // http.send(null);
      }

      setInterval(() => {
        sendData();
      }, 2000);
      setTimeout(atualizacaoPeriodica, 5000);
    }

    function obterdados(idAquario) {
      fetch(`/medidas/tempo-real/${idAquario}`)
        .then((resposta) => {
          if (resposta.ok) {
            resposta.json().then((resposta) => {
              console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

              var dados = {
                nome_album: resposta[0].nome_album,
                votos: resposta[0].votos,
              };

              // console.log(dados)

              qtd_votos = [
                resposta[0].votos,
                resposta[1].votos,
                resposta[2].votos,
                resposta[3].votos,
                resposta[4].votos,
                resposta[5].votos,
                resposta[6].votos,
                resposta[7].votos,
                resposta[8].votos,
                resposta[9].votos,
                resposta[10].votos,
                resposta[11].votos,
                resposta[12].votos,
              ];

              album = [
                resposta[0].nome_album,
                resposta[1].nome_album,
                resposta[2].nome_album,
                resposta[3].nome_album,
                resposta[4].nome_album,
                resposta[5].nome_album,
                resposta[6].nome_album,
                resposta[7].nome_album,
                resposta[8].nome_album,
                resposta[9].nome_album,
                resposta[10].nome_album,
                resposta[11].nome_album,
                resposta[12].nome_album,
              ];

              alertar(resposta[0].temperatura, idAquario, resposta[0].umidade);
            });
          } else {
            console.error("Nenhum dado encontrado ou erro na API");
          }
        })
        .catch(function (error) {
          console.error(
            `Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`
          );
        });
    }

    var qtd_votos = [];

    var album = [];

    var output_card_id = [
      card_1,
      card_2,
      card_3,
      card_4,
      card_5,
      card_6,
      card_7,
      card_8,
      card_9,
      card_10,
      card_11,
      card_12,
      card_13,
    ];

    var output_numero_votos = [
      numero_votos_1,
      numero_votos_2,
      numero_votos_3,
      numero_votos_4,
      numero_votos_5,
      numero_votos_6,
      numero_votos_7,
      numero_votos_8,
      numero_votos_9,
      numero_votos_10,
      numero_votos_11,
      numero_votos_12,
      numero_votos_13,
    ];

    function alertar(nome_album, id_album) {
      var limites = {
        pouco_ouvido: 5,
        bem_ouvido: 6,
        muito_ouvido: 9,
      };

      for (var posicao = 0; posicao < album.length; posicao++) {
        var quatidade_votos = qtd_votos[posicao];
        if (quatidade_votos >= limites.muito_ouvido) {
          output_card_id[posicao].style.backgroundColor = "#9ccc65";
          output_numero_votos[posicao].innerHTML = `${quatidade_votos} votos`;
          console.log("Muito ouvido - Mais votos");
        } else if (quatidade_votos >= limites.bem_ouvido) {
          output_card_id[posicao].style.backgroundColor = "#5c6bc0";
          output_numero_votos[posicao].innerHTML = `${quatidade_votos} votos`;
          console.log("ouvido - media de votos"); 
        } else {
          output_card_id[posicao].style.backgroundColor = "#ff7043";
          output_numero_votos[posicao].innerHTML = `${quatidade_votos} votos`;
          console.log("Pouco ouvido - Menos votos");
        }
      }
    }
  </script>
</html>